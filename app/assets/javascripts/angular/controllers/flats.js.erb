app.controller('ListRoomCtrl', ['$scope', '$http', '$auth', '$location', 'Upload', function($scope, $http, $auth, $location, Upload){

  var url = "<%= ENV['URL'] %>" || "http://localhost:3000";

  $scope.flat = {};
  $scope.form = {};
  $scope.image = {};

  $scope.BuildingType = [
    {Id: 1, Name: 'Chinese walk up'}, 
    {Id: 2, Name: 'House'}, 
    {Id: 3, Name: 'Appartment'}, 
    {Id: 4, Name: 'Sharehouse'}, 
    {Id:4, Name: 'Penthouse'}];

  $scope.Num= [
    {Id: 1, Name: '1'}, 
    {Id: 2, Name: '2'}, 
    {Id: 3, Name: '3'},
    {Id: 4, Name: '4'},
    {Id:5, Name: '5'},
    {Id:6, Name: '6'},
    {Id:7, Name: '7'},
    {Id:8, Name: '8+'}];

  $scope.RoomBathroom = [
    {Id: 1, Name: 'Shared'}, 
    {Id: 2, Name: 'Ensuite'}];


  $scope.Bed= [
    {Id: 1, Name: 'Single'}, 
    {Id: 2, Name: 'Double'},
    {Id: 3, Name: 'Queen'},
    {Id: 4, Name: 'King'},
    {Id:5, Name: 'Bunk bed'}];

  $scope.form.create = function(){
    var data = {
      'building_number':        $scope.flat.building_number,
      'building_street_name':   $scope.flat.building_street_name,
      'building_district_name': $scope.flat.building_district_name,
      'building_type':          $scope.flat.building_type,
      'building_have_elevator': $scope.flat.building_have_elevator,
      'property_floor':         $scope.flat.property_floor,
      'property_nbr_of_rooms': $scope.flat.property_nbr_of_rooms,
      'property_nbr_of_bathrooms': $scope.flat.property_nbr_of_bathrooms,
      'property_can_smoke': $scope.flat.property_can_smoke,
      'property_have_wifi': $scope.flat.property_have_wifi,
      'are_pets_allowed': $scope.flat.are_pets_allowed,
      'room_rent_amount': $scope.flat.room_rent_amount,
      'room_date_available': $scope.flat.room_date_available,
      'room_preference': $scope.flat.room_preference,
      'room_no_beds': $scope.flat.room_no_beds,
      'room_type_bed': $scope.flat.room_type_bed,
      'is_room_furnished': $scope.flat.is_room_furnished,
      'room_bathroom': $scope.flat.room_bathroom,
      'room_description': $scope.flat.room_description
    };

    $scope.upload = Upload.upload({
      url: url + '/flats',
      method: 'POST',
      data: data,
      file: $scope.image.file,
      fileFormDataName: 'flat[image]',
        formDataAppender: function(fd, key, val) {
            if (angular.isArray(val)) {
                angular.forEach(val, function(v) {
                    fd.append('flat['+key+']', v);
                });
            } else {
                fd.append('flat['+key+']', val);
            }
        }
    });

    $http.post(url + '/flats', {flat: data}).success(function(response){
      console.log(response);
    });
  };
}]);
